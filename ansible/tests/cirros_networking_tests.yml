- name: Wait for console port to answer
  wait_for:
    port: "{{centos_console_port}}"

- name: Instance should have a configured eth0
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} ifconfig eth0 | grep -c "192.168.242"` -eq 1 ]

- name: Instance should have a configured DNS resolver
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} cat /etc/resolv.conf | grep -c "8.8.8.8"` -eq 1 ]

- name: Instance should have a configured default route
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} netstat -rn | grep -c "192.168.242.1"` -eq 1 ]

- name: Instances should be able to ping their gateway
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} ping 192.168.242.1 | grep -c " 0% packet loss"` -eq 1 ]

- name: Instances should be able to ping their DHCP server
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} ping 192.168.242.2 | grep -c " 0% packet loss"` -eq 1 ]

- name: Instances should be able to ping Google
  shell: |
    [ `/opt/telnet_client.py {{centos_console_port}} ping 8.8.8.8 | grep -c " 0% packet loss"` -eq 1 ]
